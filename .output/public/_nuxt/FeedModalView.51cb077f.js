import{o as i,q as n,b as a,f,w as T,s as C,t as m,u as s,c as J,Q as E,x as l,I as h,y as X,S as Z,T as ee,U as O,V as S,N as V,l as j,m as ke,C as ge,k as he,a3 as ye,r as y,p as _e,O as K,H as q,a5 as $e,e as x,v as p,M as Me,W as be}from"./entry.ea93fdf2.js";import{u as xe}from"./useFeed.53b119c5.js";import{M as Ce,_ as Ie,u as pe}from"./ModalView.4408fcca.js";import{S as Q}from"./ProBadge.e3dc9c3a.js";import{P as te}from"./index.af539870.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";const se=e=>(Z("data-v-cb99de45"),e=e(),ee(),e),Ee={class:"flex flex-row gap-2"},Le=["src"],Ae={class:"mini__artist__name-username"},Te=se(()=>a("br",null,null,-1)),Be=se(()=>a("span",{class:"dot-divider"},"·",-1)),Re={__name:"ArtistDetail",props:{feed:{type:Object,default:()=>{}},isModal:{type:Boolean,default:!1},showCloseButton:{type:Boolean,default:!1},closeModalTarget:{type:String,default:""},isArtwork:{type:Boolean,default:!1}},setup(e){return(w,r)=>{const u=X;return e.feed.users?(i(),n("section",{key:0,id:"artist-info",class:h(["mini__artist",{"!px-0":e.isModal}])},[a("div",Ee,[f(u,{class:"mini__artist__avatar",to:"/u/"+e.feed.users.username},{default:T(()=>[a("img",{src:w.avatarCoverUrl(e.feed.users.avatar_bucket,e.feed.users.avatar_filename),onError:r[0]||(r[0]=(...d)=>w.defaultCoverImage&&w.defaultCoverImage(...d))},null,40,Le)]),_:1},8,["to"]),a("div",Ae,[f(u,{to:"/u/"+e.feed.users.username,class:"name"},{default:T(()=>[C(m(e.feed.users.name),1)]),_:1},8,["to"]),Te,f(u,{to:"/u/"+e.feed.users.username,class:"username"},{default:T(()=>[C(" @"+m(e.feed.users.username),1)]),_:1},8,["to"]),Be,f(u,{to:(e.feed.type===s(te).ARTWORK||e.isArtwork?"/a/":"/feed/")+e.feed.id,class:"post-date"},{default:T(()=>[C(m(w.formatDate(e.feed.scheduled_post?e.feed.scheduled_post:e.feed.created_at,!0)),1)]),_:1},8,["to"])])]),e.showCloseButton?(i(),J(E,{key:0,name:"i-ion-close-outline","text-size":"text-2xl",onClick:r[1]||(r[1]=d=>w.closeModal(e.closeModalTarget))})):l("",!0)],2)):l("",!0)}}},oe=D(Re,[["__scopeId","data-v-cb99de45"]]);const Oe=["images"],Se=["src"],Ve=["images"],Fe=["src"],De=["images"],Pe=["src"],Ne=["images"],je=["src"],Ue={key:4,class:"imgrid"},ze=["src"],We={key:1,class:"relative text-center"},He={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Ge=["src"],Ye={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(e){const w={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(r,u)=>(i(),n("div",null,[e.work.artwork_assets.length===1?(i(),n("div",{key:0,images:[r.artworkThumb(e.work.artwork_assets[0].bucket,e.work.artwork_assets[0].filename,"feed")]},[a("img",{src:r.artworkThumb(e.work.artwork_assets[0].bucket,e.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},onError:u[0]||(u[0]=(...d)=>r.imageLoadError&&r.imageLoadError(...d))},null,40,Se)],8,Oe)):l("",!0),e.work.artwork_assets.length===2?(i(),n("div",{key:1,images:e.work.images,class:"imgrid"},[(i(!0),n(O,null,S(e.work.images,(d,$)=>(i(),n("img",{key:d,class:h(w[2][$]),src:d,onError:u[1]||(u[1]=(...M)=>r.imageLoadError&&r.imageLoadError(...M))},null,42,Fe))),128))],8,Ve)):l("",!0),e.work.artwork_assets.length===3?(i(),n("div",{key:2,images:e.work.images,class:"imgrid"},[(i(!0),n(O,null,S(e.work.images,(d,$)=>(i(),n("img",{key:d,class:h(w[3][$]),src:d,onError:u[2]||(u[2]=(...M)=>r.imageLoadError&&r.imageLoadError(...M))},null,42,Pe))),128))],8,De)):l("",!0),e.work.artwork_assets.length===4?(i(),n("div",{key:3,images:e.work.images,class:"imgrid"},[(i(!0),n(O,null,S(e.work.images,d=>(i(),n("img",{key:d,src:d,onError:u[3]||(u[3]=(...$)=>r.imageLoadError&&r.imageLoadError(...$))},null,40,je))),128))],8,Ne)):l("",!0),e.work.artwork_assets.length>4?(i(),n("div",Ue,[(i(!0),n(O,null,S(e.work.images,(d,$)=>(i(),n("div",{key:$},[$<3?(i(),n("img",{key:0,src:d,onError:u[4]||(u[4]=(...M)=>r.imageLoadError&&r.imageLoadError(...M))},null,40,ze)):(i(),n("div",We,[a("span",He,"+"+m(e.work.artwork_assets.length-4),1),a("img",{src:d,class:"z-0 brightness-50",onError:u[5]||(u[5]=(...M)=>r.imageLoadError&&r.imageLoadError(...M))},null,40,Ge)]))]))),128))])):l("",!0)]))}},Ke=D(Ye,[["__scopeId","data-v-147f3f1b"]]);const qe={key:0,class:"feed__info"},Qe={class:"feed__info__title"},Je={key:0,class:"feed__info__description"},Xe=["id","innerHTML"],Ze=["id"],et={__name:"ArtworkMetadata",props:{bypass:{type:Boolean,default:!1},feed:{type:Object,default:()=>{}},isModal:{type:Boolean,default:!1},shareIdentifier:{type:Number,default:0}},emits:["readMore"],setup(e){return(w,r)=>e.bypass||e.feed.type===s(te).ARTWORK?(i(),n("div",qe,[a("span",Qe,m(e.feed.title),1),e.feed.description?(i(),n("div",Je,[a("p",{id:`${e.shareIdentifier}-${e.isModal}-feed-description-`+e.feed.id,class:"feed-description",innerHTML:e.feed.description.length>300?`${e.feed.description.slice(0,300)}...`:e.feed.description},null,8,Xe),e.feed.description.length>300?(i(),n("a",{key:0,id:`${e.shareIdentifier}-${e.isModal}-feed-read-more-`+e.feed.id,onClick:r[0]||(r[0]=V(u=>w.$emit("readMore",e.feed.description,e.feed.id,`${e.shareIdentifier}-${e.isModal}-feed-read-more-`,`${e.shareIdentifier}-${e.isModal}-feed-description-`),["prevent"]))},m(w.$t("readMore")),9,Ze)):l("",!0)])):l("",!0)])):l("",!0)}},tt=D(et,[["__scopeId","data-v-ac9921d0"]]),st={key:0},ot={key:1},at={class:"mx-auto mt-2 primary-button"},it={__name:"SharedArtworkDetail",props:{colorReversed:{type:Boolean,default:!1},feed:{type:Object,default:()=>{}},feedIdx:{type:Number,default:()=>0},readMore:{type:Function,default:()=>({})},isModal:{type:Boolean,default:!1}},emits:["readMore","view"],setup(e){const w=j();return(r,u)=>e.feed.artwork_share_info?(i(),n("section",{key:0,id:"shared-artwork-info",class:h(["my-2 w-full rounded-md",e.colorReversed?"theme-color":"theme-color-secondary"])},[f(oe,{feed:e.feed.artwork_share_info,"is-artwork":!0},null,8,["feed"]),f(tt,{"share-identifier":e.feed.id,feed:e.feed.artwork_share_info,bypass:!0,"is-modal":e.isModal,onReadMore:e.readMore},null,8,["share-identifier","feed","is-modal","onReadMore"]),a("div",null,[a("div",{class:h(["p-2",{"cursor-pointer":!e.feed.apply_explicit_filter||e.feed.apply_gore_filter}]),onClick:u[0]||(u[0]=V(d=>r.$emit("view",e.feed.artwork_share_info.id,e.feed.apply_gore_filter?e.feed.apply_gore_filter:e.feed.apply_explicit_filter,e.feedIdx),["prevent"]))},[a("div",{class:h(["overflow-hidden relative md:p-2 rounded-md",{"md:mx-2":e.feed.apply_explicit_filter||e.feed.apply_gore_filter}])},[f(Ke,{class:h([{"blur-3xl unclickable":e.feed.apply_explicit_filter||e.feed.apply_gore_filter},e.feed.apply_explicit_filter||e.feed.apply_gore_filter?"brightness-50":"brightness-100"]),work:e.feed},null,8,["class","work"]),e.feed.apply_explicit_filter||e.feed.apply_gore_filter?(i(),n("div",{key:0,class:h(["p-2 mx-auto w-full text-center rounded-md opacity-90",e.feed.apply_gore_filter?"bg-red-500 text-white":"bg-yellow-300 text-black"])},[e.feed.apply_explicit_filter&&!e.feed.apply_gore_filter?(i(),n("div",st,m(s(w).loggedIn?r.$t("explicitContentAlert"):r.$t("explicitContentAlertForGuest")),1)):l("",!0),e.feed.apply_gore_filter?(i(),n("div",ot,m(s(w).loggedIn?r.$t("goreContentAlert"):r.$t("goreContentAlertForGuest")),1)):l("",!0),a("button",at,m(r.$t("explicitShowMeThisContent")),1)],2)):l("",!0)],2)],2)])],2)):l("",!0)}},nt=["id","innerHTML"],rt=["id"],dt={__name:"TextPostDetail",props:{bypass:{type:Boolean,default:!1},isModal:{type:Boolean,default:!1},colorReversed:{type:Boolean,default:!1},feed:{type:Object,default:()=>{}},feedIdx:{type:Number,default:()=>0},readMore:{type:Function,default:()=>({})},viewArtwork:{type:Function,default:()=>({})}},emits:["readMore"],setup(e){return j(),(w,r)=>e.bypass||e.feed.type==="feed"?(i(),n("section",{key:0,id:"text-feed",class:h(["px-2 mb-2 mx-0 md:px-4",{"!p-0":e.isModal}])},[e.feed.text?(i(),n("p",{key:0,id:`${e.isModal}feed-text-`+e.feed.id,innerHTML:e.feed.text.length>500?`${e.feed.text.slice(0,500)}...`:e.feed.text},null,8,nt)):l("",!0),e.feed.text&&e.feed.text.length>500?(i(),n("a",{key:1,id:`${e.isModal}feed-text-read-more-`+e.feed.id,class:"href read-more-button",onClick:r[0]||(r[0]=V(u=>w.$emit("readMore",e.feed.text,e.feed.id,`${e.isModal}feed-text-read-more-`,`${e.isModal}feed-text-`),["prevent"]))},m(w.$t("readMore")),9,rt)):l("",!0),f(it,{feed:e.feed,"color-reversed":e.colorReversed,"feed-idx":e.feedIdx,"read-more":e.readMore,"is-modal":e.isModal,onReadMore:e.readMore,onView:e.viewArtwork},null,8,["feed","color-reversed","feed-idx","read-more","is-modal","onReadMore","onView"])],2)):l("",!0)}};const lt=e=>(Z("data-v-65026d2e"),e=e(),ee(),e),ut={class:h(["mb-2 rounded-md theme-color pb-2"])},ct={key:0,id:"interaction-buttons",class:"interactions !px-4"},mt={key:0},ft={key:1},vt={class:"interactions__items"},wt={key:1,class:"ellipsis-menus dropdown"},kt={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"ellipsis-menus"},gt={class:"ellipsis-menus__content dropdown-menu"},ht={id:"ellipsis-menus",class:"ellipsis-menus__content__wrapper","aria-labelledby":"headlessui-menu-button-1",role:"menu"},yt={key:0},_t={id:"comment-section",class:""},$t={id:"comment-input-section"},Mt={key:0},bt={class:"flex flex-col"},xt={class:"comments__comment-box"},Ct=["readonly","rows","placeholder"],It={key:1,class:"must-login-alert"},pt=["src"],Et={class:"comments__item__comment__user-info"},Lt={class:"hover:underline"},At={class:"time"},Tt={class:"break-words"},Bt={class:"comments__item__comment__buttons"},Rt=lt(()=>a("div",null,null,-1)),Ot={class:"comments__item__comment__buttons__item"},St=["onClick"],Vt={key:1,class:"comments__no-comment"},Ft={id:"shared-artwork-modal",class:"modal work-view"},Dt={__name:"FeedModalView",props:{id:{type:Number,default:0},section:{type:String,default:""},isModal:{type:Boolean,default:!1}},emits:["setMeta","showEmpty","showError"],setup(e,{expose:w,emit:r}){const u=e,d=j(),$=ke();ge();const{oApiConfiguration:M,fetchOptions:ae}=he(),I=xe(M,ae()),{generateArtworkThumb:ie}=ye(),ne=y(null);_e(()=>{u.id!==0&&W(u.id),window.addEventListener("keydown",o=>{const t=document.getElementById("chronological-modal");o.key==="Escape"&&(!t||t.style.display!="flex")&&K().closeModal(`${u.section}-modal`)})}),q(()=>c.value.id);const U=y(!0),c=y({}),L=y(!1),z=(o,t,k,g)=>{pe().readMore(o,t,k,g)},W=async o=>{U.value=!0,b.value=[],B.value.page=0;const[t,k]=await I.feedDetail({id:o});if(k)k=="Post not found"?r("showEmpty"):r("showError");else{if(t.feed.artworks){t.feed.artworks.images=[];for(let g=0;g<t.feed.artworks.artwork_assets.length;g++)if(g<=3){const v=await ie(t.feed.artworks.artwork_assets[g].bucket,t.feed.artworks.artwork_assets[g].filename,"feed");t.feed.artworks.images.push(v)}(!d.loggedIn&&t.feed.artworks.is_explicit||t.feed.artworks.is_explicit&&!d.user.user_settings.show_explicit)&&(t.feed.artworks.apply_explicit_filter=!0)}if(c.value=t.feed,L.value=t.feed.liked,await ue(o),!u.isModal){const g=t.feed.text.replace(/<[^>]*>?/gm,"");r("setMeta",{title:g>20?`${g.substring(0,20)}..`:g})}}U.value=!1},H=y(null),re=async(o,t)=>{t?c.value.artworks.apply_explicit_filter=!1:(H.value.view(o),K().openModal("shared-artwork-modal"))},de=async()=>{const[o,t]=await I.like({feedId:c.value.id});if(o){L.value=!0,c.value._count.feed_likes++;const k=document.getElementById("feedLikeButton"+c.value.id);k.classList.add("animate-bounce"),setInterval(()=>{k.classList.remove("animate-bounce")},2500)}},le=async()=>{const[o,t]=await I.unlike({feedId:c.value.id});o&&(L.value=!1,c.value._count.feed_likes--)},b=y([]),B=y({perPage:5,page:0}),R=y([]),G=async o=>{try{const[t,k]=await I.fetchComments({feedId:o,pagination:{page:B.value.page,perPage:B.value.perPage}});return t.pagination.current_page===t.pagination.first_last.last_page?F.value=!1:F.value=!0,t.comments.forEach(g=>{R.value.push(g.id)}),t.comments}catch{}},ue=async o=>{try{(await G(o)).forEach(k=>b.value.push(k))}catch{}},F=y(!1),P=y(!1),ce=async o=>{P.value=!0,B.value.page+=1,(await G(o)).forEach(k=>b.value.push(k)),P.value=!1},_=y(""),N=200,me=q(()=>_.value!=null&&_.value!==""?N-_.value.length:N),A=y(!1),fe=async()=>{A.value=!0;try{const[o,t,k]=await I.comment({feedId:c.value.id,comment:_.value});o&&(_.value="",b.value.splice(0,0,t),b.value.join(),R.value.splice(0,0,t.id),R.value.join())}catch{}A.value=!1},ve=async o=>{const[t,k]=await I.removeComment(o);if(!k){const g=R.value.indexOf(o);b.value.splice(g,1),R.value.splice(g,1)}};y([]);const we=async o=>{const[t,k]=await I.remove(o);t&&setTimeout(()=>{$.push({path:"/"})},1e3)};return w({viewFeed:W}),(o,t)=>{const k=X,g=$e("auto-animate");return i(),n("div",{class:h(["z-40 work-container work-view mx-auto",{"w-full md:w-2/3 lg:w-6/12 xl:w-4/12 py-4 pl-4 md:p-4 theme-color":e.isModal}])},[a("div",{class:h(["w-full",{"overflow-y-scroll pr-4":e.isModal}])},[a("div",ut,[f(oe,{feed:s(c),"is-modal":e.isModal,"show-close-button":e.isModal,"close-modal-target":"chronological-feed-modal",class:h([{"!-mt-2":e.isModal}])},null,8,["feed","is-modal","show-close-button","class"]),f(dt,{bypass:!0,"is-modal":e.isModal,feed:s(c),"read-more":z,view:o.view,"view-artwork":re,onReadMore:z,onView:o.view},null,8,["is-modal","feed","view","onView"])]),s(c)._count?(i(),n("section",ct,[a("div",null,[s(c)._count.feed_comments?(i(),n("div",mt,[a("b",null,m(o.thousand(s(c)._count.feed_comments)),1),C(" "+m(s(c)._count.feed_comments>1?o.$t("count.comments"):o.$t("count.comment")),1)])):l("",!0),s(c)._count.feed_comments?l("",!0):(i(),n("div",ft))]),a("div",vt,[s(d).loggedIn?(i(),n("div",{key:0,class:"interactions__item",onClick:t[0]||(t[0]=v=>s(L)?le():de())},[x(f(E,{id:"feedLikeButton"+s(c).id,name:"i-ion-heart",class:"text-red-500 hover:text-red-500"},null,8,["id"]),[[p,s(L)]]),x(f(E,{name:"i-ri-heart-3-line",class:"hover:text-red-500"},null,512),[[p,!s(L)]]),C(" "+m(o.thousand(s(c)._count.feed_likes)),1)])):l("",!0),!s(c).artworks&&s(d).loggedIn&&s(c).user_id&&s(d).user.id===s(c).user_id?(i(),n("div",wt,[a("button",kt,[a("span",null,[f(E,{name:"i-uit-ellipsis-v"})])]),a("div",gt,[a("div",ht,[s(d).loggedIn&&s(c).user_id&&s(d).user.id===s(c).user_id?(i(),n("div",yt,[a("a",{onClick:t[1]||(t[1]=v=>o.openModal("feed-deletion-confirm-modal"))},[f(E,{name:"i-akar-icons-trash-bin"}),C(" "+m(o.$t("delete")),1)])])):l("",!0)])])])):l("",!0)])])):l("",!0),a("section",_t,[a("section",$t,[s(d).loggedIn?(i(),n("div",Mt,[a("div",bt,[a("div",xt,[x(a("textarea",{ref_key:"commentInputRef",ref:ne,"onUpdate:modelValue":t[2]||(t[2]=v=>be(_)?_.value=v:null),class:h([{"cursor-not-allowed":s(A)},{"theme-color-secondary textarea":e.isModal}]),readonly:s(A),cols:"20",rows:s(_)!=""?"6":"0",placeholder:o.$t("comments.inputPlaceholder"),maxlength:N,"data-gramm":"false"},null,10,Ct),[[Me,s(_)]]),x(a("span",{class:"comments__str-left-counter"},m(s(me)),513),[[p,s(_)!=""]]),a("button",{class:"comments__submit",onClick:t[3]||(t[3]=V(v=>fe(),["prevent"]))},[x(f(E,{name:"i-carbon-send-filled"},null,512),[[p,s(_)!=""&&!s(A)]]),x(f(Q,null,null,512),[[p,s(A)]])])])])])):l("",!0),s(d).loggedIn?l("",!0):(i(),n("div",It,m(o.$t("comments.loginOrRegisterToLeaveComment")),1))]),a("div",{class:h(["comments__items",[{"overflow-x-hidden":e.isModal},{"mb-20":!e.isModal}]])},[(i(!0),n(O,null,S(s(b),v=>x((i(),n("div",{key:v.id,class:"comments__item"},[f(k,{class:"comments__item__user-avatar",to:"/u/"+v.users.username},{default:T(()=>[a("img",{src:o.avatarCoverUrl(v.users.avatar_bucket,v.users.avatar_filename),onError:t[4]||(t[4]=(...Y)=>o.defaultCoverImage&&o.defaultCoverImage(...Y))},null,40,pt)]),_:2},1032,["to"]),a("div",{class:h(["comments__item__comment",e.isModal?"theme-color-secondary":"theme-color"])},[a("div",Et,[f(k,{to:"/u/"+v.users.username},{default:T(()=>[a("b",null,m(v.users.name),1),C("  "),a("span",Lt,"@"+m(v.users.username),1)]),_:2},1032,["to"]),a("div",At,m(o.formatDate(v.created_at,!0)),1)]),a("p",Tt,m(v.comment),1),a("div",Bt,[Rt,a("div",Ot,[v.users.id===s(d).user.id?(i(),n("button",{key:0,onClick:Y=>ve(v.id)},[f(E,{name:"i-akar-icons-trash-bin","text-size":"text-base",class:"hover:bg-red-400"})],8,St)):l("",!0)])])],2)])),[[g]])),128)),s(c)._count?x((i(),n("div",{key:0,class:"comments__load-more-button",onClick:t[5]||(t[5]=V(v=>ce(s(c).id),["prevent"]))},[s(P)?(i(),J(Q,{key:0})):l("",!0),C(" "+m(o.$t("comments.loadOlder")),1)],512)),[[p,s(c)._count.feed_comments>s(B).perPage&&s(F)]]):l("",!0),x(a("div",{class:"comments__no-more-item"},m(o.$t("comments.reachedTheEnd")),513),[[p,s(b).length&&!s(F)]]),s(d).loggedIn&&!s(b).length?(i(),n("div",Vt,m(o.$t("comments.noCommentYet")),1)):l("",!0)],2)])],2),a("div",Ft,[f(Ce,{ref_key:"sharedWorkModalViewRef",ref:H,section:"shared-artwork"},null,512)]),f(Ie,{id:"feed-deletion-confirm-modal","modal-id":"feed-deletion-confirm-modal",message:`${o.$t("alert.areYouSure")} ${o.$t("alert.youCannotUndoThisAction")}`,class:"modal",onOnAccept:t[6]||(t[6]=v=>we(s(c).id))},null,8,["message"])],2)}}},Ht=D(Dt,[["__scopeId","data-v-65026d2e"]]);export{tt as A,Ht as F,Ke as I,dt as _,oe as a};
