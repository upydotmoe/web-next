import{o as f,s as b,b as e,f as x,U as P,l as W,k as L,r as _,x as t,u as s,e as i,v as d,K as m,y as U,X as T,Y as N,t as V,O as Q,Q as Y,h as X,m as q,p as G,J as Z,c as F,w as ee,P as j,V as se,W as te}from"./entry.72e29a02.js";import{u as z}from"./useReport.2eeb79b9.js";import{u as K}from"./useI18n.05db24cf.js";import{P as S}from"./index.7225a9bd.js";import{L as oe}from"./Layout.a8963777.js";import{_ as H}from"./LoadingEmptyErrorMessage.5882bbb2.js";import{_ as J}from"./_plugin-vue_export-helper.c27b6911.js";import"./ProBadge.2656324d.js";const le={class:"flex float-right flex-row gap-2 mb-2 cursor-pointer"},ne={__name:"CloseModalButton",emits:["close"],setup(R,{emit:u}){const I=()=>{u("close")};return($,k)=>(f(),b("div",le,[e("div",{class:"modal-close",onClick:k[0]||(k[0]=M=>I())},[x(P,{name:"i-ion-close",class:"text-2xl"})])]))}};const re={class:"w-full modal-layer xl:w-3/12 lg:w-2/5"},ae={class:"flex flex-row justify-between w-full"},ie={class:"title"},de={class:"report_detail"},ue={class:"report_detail__badge"},pe={class:"report_detail__info"},ce={key:0},ve=["href"],_e={class:"tags"},fe={class:"tag"},me={class:"my-4 custom-divider"},ge={class:"flex flex-row gap-2 justify-between"},he=["placeholder"],be={__name:"ReportDetailModal",emits:["refresh"],setup(R,{expose:u,emit:I}){const $=W(),{oApiConfiguration:k,fetchOptions:M}=L(),c=z(k,M()),g=_(!0),w=_(!1),n=_({}),y=_([]),D=async r=>{g.value=!0,w.value=!1;const[a,v]=await c.getReportById({reportId:r});v?w.value=!0:(n.value=a,y.value=a.reasons.split(",")),g.value=!1},p=_({response:0,description:""}),C=async()=>{const[r,a]=await c.reviewReport({reportId:n.value.id,response:p.value.response,responseDescription:p.value.description});a||(await D(n.value.id),Y().closeModal("report-detail-modal"),I("refresh"))};return u({view:D}),(r,a)=>(f(),b("div",null,[e("button",{class:"hidden",onClick:a[0]||(a[0]=v=>D())}),e("div",re,[e("div",ae,[e("span",ie,t(r.$t("reports.reportDetail")),1),x(ne,{onClose:a[1]||(a[1]=v=>r.closeModal("report-detail-modal"))})]),x(H,{loading:s(g),error:s(w)},null,8,["loading","error"]),i(e("div",de,[e("div",ue,[e("span",{class:m(s(n).status==="pending"?"bg-yellow-500":"bg-red-500")},t(s(n).status),3)]),e("div",pe,[e("section",null,[e("div",null,[e("label",null,t(r.$t("reports.reportId")),1),e("div",null," #"+t(s(n).id),1)]),e("div",null,[e("label",null,t(r.$t("reports.reportDate")),1),e("div",null,t(r.formatDate(s(n).created_at)),1)]),s(n).user_reported?(f(),b("div",ce,[e("label",null,t(r.$t("reports.userReporting")),1),e("div",null,t(s(n).user_reported.username),1)])):U("",!0),e("div",null,[e("label",null,t(r.$t("reports.reportedPost")),1),e("div",null,[i(e("span",{class:"italic"},t(r.$t("reports.postRemoved")),513),[[d,s(n).is_removed]]),i(e("a",{href:(s(n).type===s(S).ARTWORK?"/a/":"/feed/")+s(n).post_id,target:"blank",class:"href"},t(r.$t("reports.viewPost")),9,ve),[[d,!s(n).is_removed]])])]),e("div",null,[e("label",null,t(r.$t("reports.reportDescription")),1),e("div",null,t(s(n).description),1)]),e("div",null,[e("label",null,t(r.$t("reports.selectedReasons")),1),e("div",_e,[(f(!0),b(T,null,N(s(y),v=>(f(),b("span",fe,t(r.$t("reports.reasons."+v)),1))),256))])])]),i(e("div",me,null,512),[[d,(s($).user.is_admin||s($).user.is_moderator)&&s(n).status==="pending"||s(n).status==="closed"]]),i(e("section",null,[e("div",ge,[e("span",{class:m(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-green-500 cursor-pointer",{"bg-green-500 text-white":s(p).response===0}]),onClick:a[2]||(a[2]=v=>s(p).response=0)},[i(x(P,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[d,s(p).response===0]]),V(" "+t(r.$t("reports.decisions.doNotRemove")),1)],2),e("span",{class:m(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-red-500 cursor-pointer",{"bg-red-500 text-white":s(p).response===1}]),onClick:a[3]||(a[3]=v=>s(p).response=1)},[i(x(P,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[d,s(p).response===1]]),V(" "+t(r.$t("reports.decisions.remove")),1)],2)]),e("div",null,[i(e("textarea",{"onUpdate:modelValue":a[4]||(a[4]=v=>s(p).description=v),class:"form-input input textarea",rows:"5",cols:"0",placeholder:r.$t("description"),"data-gramm":"false"},null,8,he),[[Q,s(p).description]])]),e("button",{class:m(s(p).description?"primary-button":"disabled-button"),onClick:a[5]||(a[5]=v=>C())},t(r.$t("reports.submitReviewAndClose")),3)],512),[[d,(s($).user.is_admin||s($).user.is_moderator)&&s(n).status==="pending"]]),i(e("section",null,[e("div",null,[e("label",null,t(r.$t("reports.decision")),1),e("div",null,[e("span",{class:m(["font-bold uppercase",s(n).response?"text-green-500":"text-red-500"])},t(s(n).response?"Removed":"Not removed"),3)])]),e("div",null,[e("label",null,t(r.$t("description")),1),e("div",null,t(s(n).response_description),1)]),e("div",null,[e("label",null,t(r.$t("reports.decisionMadeAt")),1),e("div",null,t(r.formatDate(s(n).responded_at)),1)])],512),[[d,s(n).status==="closed"]])])],512),[[d,!s(g)]])])]))}},$e=J(be,[["__scopeId","data-v-4aafd60b"]]);const B=R=>(se("data-v-52b9bed6"),R=R(),te(),R),we={class:"reports"},ye={class:"reports__title"},Re=B(()=>e("div",{class:"reports__filters"},null,-1)),ke={class:"reports__list"},De={class:"hidden-md-flex"},Ce={class:"reports__table",cellspacing:"0",cellpadding:"0"},xe={class:"rounded-l-md"},Ie=B(()=>e("th",null,[e("div",{class:"rounded-r-md"},"   ")],-1)),Me={class:"rounded-l-md"},Ae=["onClick"],Pe=["href"],Te=["href"],Ne={class:"font-bold uppercase"},Se={class:"font-bold uppercase"},Be={class:"rounded-r-md"},Ee=["onClick"],Oe=["href"],Ve={class:"text-right md:text-left"},Fe={class:"font-bold uppercase"},je={class:"font-bold uppercase"},Ke=B(()=>e("label",null," ",-1)),We=["href"],Le=["onClick"],Ue={class:"reports__pagination"},Ye={__name:"index",setup(R){const u=W(),{oApiConfiguration:I,fetchOptions:$}=L(),k=z(I,$());X({title:u.user.is_admin||u.user.is_moderator?K().tl("reports.reports"):K().tl("reports.yourReports")});const M=q();G(async()=>{u.loggedIn?await y():M.push({path:"/explore",force:!0})});const c=_({loading:!1,pagination:{page:0,perPage:10}}),g=_({status:"all",filterDateFrom:void 0,filterDateTo:void 0,userId:Z(()=>{if(u.loggedIn&&!u.user.is_admin&&!u.user.is_moderator)return u.user.id}),selectedReasons:void 0}),w=_([]),n=_({}),y=async()=>{p(),c.value.loading=!0;const[l,h,o]=await k.getReports({status:g.value.status,createdAtFrom:g.value.filterDateFrom,createdAtTo:g.value.filterDateTo,userId:g.value.userId,reasons:g.value.selectedReasons,pagination:{page:c.value.pagination.page,perPage:c.value.pagination.perPage}});o?v():(h.record_total<=0&&r(),w.value=l,n.value=h),c.value.loading=!1},D=async l=>{l==="next"?c.value.pagination.page++:c.value.pagination.page--,await y()},p=()=>{C.value=!1,a.value=!1},C=_(!1),r=()=>{C.value=!0},a=_(!1),v=()=>{a.value=!0},E=_(null),A=l=>{E.value.view(l),Y().openModal("report-detail-modal")};return(l,h)=>(f(),F(oe,{"hide-side":!0,"no-right-side":!0},{default:ee(()=>[e("div",we,[e("div",ye,t(s(u).user.is_admin||s(u).user.is_moderator?l.$t("reports.reports"):l.$t("reports.yourReports")),1),Re,e("div",ke,[i(e("div",null,[e("div",De,[e("table",Ce,[e("thead",null,[e("tr",null,[e("th",null,[e("div",xe,t(l.$t("reports.reportId")),1)]),e("th",null,[e("div",null,t(l.$t("reports.reportDate")),1)]),i(e("th",null,[e("div",null,t(l.$t("reports.user")),1)],512),[[d,s(u).user.is_moderator&&s(u).user.is_admin]]),e("th",null,[e("div",null,t(l.$t("reports.post")),1)]),e("th",null,[e("div",null,t(l.$t("reports.description")),1)]),e("th",null,[e("div",null,t(l.$t("reports.status")),1)]),e("th",null,[e("div",null,t(l.$t("reports.decision")),1)]),Ie])]),e("tbody",null,[(f(!0),b(T,null,N(s(w),o=>(f(),b("tr",{key:o.id},[e("td",null,[e("div",Me,[e("a",{class:"font-bold hover:underline href",onClick:j(O=>A(o.id),["prevent"])}," #"+t(o.id),9,Ae)])]),e("td",null,[e("div",null,t(l.formatDate(o.created_at)),1)]),i(e("td",null,[e("div",null,[e("a",{href:"/u/"+o.user_reported.username,target:"blank",class:"font-bold href"},t(o.user_reported.username),9,Pe)])],512),[[d,s(u).user.is_moderator&&s(u).user.is_admin]]),e("td",null,[e("div",null,[i(e("span",{class:"italic"},t(l.$t("reports.postRemoved")),513),[[d,o.is_removed]]),i(e("a",{href:(o.type===s(S).ARTWORK?"/a/":"/feed/")+o.post_id,target:"blank",class:"href"},t(l.$t("reports.viewPost")),9,Te),[[d,!o.is_removed]])])]),e("td",null,[e("div",null,t(o.description.length>300?`${o.description.slice(0,300)}...`:o.description),1)]),e("td",Ne,[e("div",null,[e("span",{class:m(["text-white uppercase badge text-xxs",o.status==="pending"?"bg-yellow-500":"bg-red-500"])},t(o.status),3)])]),e("td",null,[e("div",Se,[i(e("span",null,"-",512),[[d,o.status==="pending"]]),i(e("span",{class:m(["text-white uppercase badge text-xxs",o.response?"bg-green-500":"bg-red-500"])},t(o.response?"Removed":"Not removed"),3),[[d,o.status==="closed"]])])]),e("td",Be,[e("div",null,[e("a",{class:"underline href",onClick:j(O=>A(o.id),["prevent"])},t(l.$t("reports.moreInfo")),9,Ee)])])]))),128))])])]),(f(!0),b(T,null,N(s(w),o=>(f(),b("div",{key:o.id,class:"reports__cards"},[e("div",null,[e("label",null,t(l.$t("reports.user")),1),e("div",null,[e("a",{href:"/u/"+o.user_reported.username,target:"blank",class:"font-bold href"},t(o.user_reported.username),9,Oe)])]),e("div",null,[e("label",null,t(l.$t("reports.description")),1),e("div",Ve,t(o.description),1)]),e("div",null,[e("label",null,t(l.$t("reports.reportDate")),1),e("div",null,t(l.formatDate(o.created_at)),1)]),e("div",null,[e("label",null,t(l.$t("reports.status")),1),e("div",Fe,[e("div",{class:m(["text-white uppercase badge text-xxs",o.status==="pending"?"bg-yellow-500":"bg-red-500"])},t(o.status),3)])]),e("div",null,[e("label",null,t(l.$t("reports.decision")),1),e("div",je,[e("span",{class:m(["text-white uppercase badge text-xxs",o.response?"bg-green-500":"bg-red-500"])},t(o.response?"Removed":"Not removed"),3)])]),e("div",null,[Ke,e("div",null,[i(e("span",{class:"mr-2 italic"},t(l.$t("reports.postRemoved")),513),[[d,o.is_removed]]),i(e("a",{href:(o.type===s(S).ARTWORK?"/a/":"/feed/")+o.post_id,target:"blank",class:"mr-2 underline href"},t(l.$t("reports.viewReportedPost")),9,We),[[d,!o.is_removed]]),e("div",{class:"underline href",onClick:O=>A(o.id)},t(l.$t("reports.moreInfo")),9,Le)])])]))),128)),i(e("div",Ue,[e("button",{class:m(s(n).next_previous&&s(n).next_previous.prev_page!==null?"primary-button":"disabled-button"),onClick:h[0]||(h[0]=o=>D("prev"))},t(l.$t("pagination.previous")),3),e("button",{class:m(s(n).next_previous&&s(n).next_previous.next_page!==null?"primary-button":"disabled-button"),onClick:h[1]||(h[1]=o=>D("next"))},t(l.$t("pagination.next")),3)],512),[[d,s(n).total_page>0]])],512),[[d,!s(c).loading&&!s(C)&&!s(a)]]),x(H,{loading:s(c).loading,empty:s(C),error:s(a),fetch:y},null,8,["loading","empty","error"])])]),s(c).loading?U("",!0):(f(),F($e,{key:0,id:"report-detail-modal",ref_key:"reportDetailModalRef",ref:E,class:"modal",onRefresh:h[2]||(h[2]=o=>y())},null,512))]),_:1}))}},es=J(Ye,[["__scopeId","data-v-52b9bed6"]]);export{es as default};
